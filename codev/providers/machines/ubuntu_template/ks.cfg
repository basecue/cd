#Generated by Kickstart Configurator
#platform=AMD64 or Intel EM64T

#System language
lang en_GB
#Language modules to install
langsupport cs_CZ en_GB --default=en_GB
#System keyboard
keyboard us
#System mouse
mouse
#System timezone
timezone Europe/Prague
#Root password
#rootpw --disabled
rootpw --iscrypted {encrypted_password}
#Initial user
user {username} --fullname "{username}" --iscrypted --password {encrypted_password}
#Poweroff after installation
poweroff
#Use text mode install
text
#Install OS instead of upgrade
install
#Use CDROM installation media
cdrom
#System bootloader configuration
bootloader --location=mbr
#Clear the Master Boot Record
zerombr yes
#Partition clearing information
clearpart --all --initlabel
#Disk partitioning information
part / --fstype {fstype} --size 1 --grow
part swap --size 2048
#System authorization infomation
#auth  --useshadow  --enablemd5
authconfig --enableshadow --passalgo=sha512

#Network information
network --bootproto=dhcp --device={device_1} --hostname {hostname}
#network --bootproto=dhcp --device={device_2}

#Firewall configuration
firewall --disabled
#Do not configure the X Window System
skipx
%packages
{packages}

%post --nochroot

{post_nochroot}

%post

{post}
cat >> /etc/network/interfaces << EOF_network_interfaces

auto {device_2}
iface {device_2} inet dhcp
# iface {device_2} inet static
#     address {ip}
#     netmask 255.255.255.0
#
EOF_network_interfaces


# Create the .ssh directory
mkdir /root/.ssh

cat > /root/.ssh/authorized_keys << EOF_id_rsa_pub
{ssh_authorized_keys}
EOF_id_rsa_pub

Modify the permissions for the ssh key
chown root:root -R /root/.ssh/
chmod 700 -R /root/.ssh/


# Modify sshd_config
/bin/sed -i 's/PermitRootLogin no/PermitRootLogin yes/' /etc/ssh/sshd_config
/bin/sed -i 's/PermitRootLogin without-password/PermitRootLogin yes/' /etc/ssh/sshd_config
/usr/sbin/service sshd restart

# Modify grub2 config
# /bin/sed -i 's/GRUB_CMDLINE_LINUX_DEFAULT=""/GRUB_CMDLINE_LINUX_DEFAULT="irqpoll"/' /etc/default/grub
# update-grub
